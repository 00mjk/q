<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="q : q - Text as Data" />

    <link rel="stylesheet" type="text/css" media="screen" href="../stylesheets/stylesheet.css">

    <title>Usage</title>
    <script type="text/javascript" src="../javascripts/google-analytics.js"></script>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <img id="q-logo" src="../images/q-logo1.png"/>
          <a id="forkme_banner" href="https://github.com/harelba/q">View on GitHub</a>

          <h1 id="project_title">q</h1>
          <h2 id="project_tagline">q - Text as Data</h2>


	  <iframe src="http://ghbtns.com/github-btn.html?user=harelba&repo=q&type=watch&count=true&size=large"  allowtransparency="true" frameborder="0" scrolling="0" width="170" height="30"></iframe>

            <section id="downloads">
              <a class="zip_download_link" download href="https://github.com/harelba/q/archive/1.5.0.zip">Download the last stable version zip file </a>
              <a class="tar_download_link" download href="https://github.com/harelba/q/archive/1.5.0.tar.gz">Download the last stable version tar.gz file</a>
              <a class="rpm_download_link" download href="https://github.com/harelba/packages-for-q/raw/master/rpms/q-text-as-data-1.5.0-1.noarch.rpm">Download the latest stable version RPM</a>
              <a class="deb_download_link" download href="https://github.com/harelba/packages-for-q/raw/master/deb/q-text-as-data_1.5.0-1_all.deb">Download the latest stable version Debian package</a>
              <a class="executable_download_link" title="Single file executable, for systems with python installed" href="https://cdn.rawgit.com/harelba/q/1.5.0/bin/q">Download the single-file executable</a>
              <a class="windows_download_link" title="Beta installation for Windows systems. Adds q.exe to the path. Please send me any comments" href="https://github.com/harelba/packages-for-q/raw/master/windows/setup-q-1.5.0.exe">Download the single-file executable</a>
            </section>
        </header>
    </div>

    <div id="sidenav">
        <h1 id="general">一般</h1>
        <ul>
        <li><a href="index.html">ホーム</a></li>
        <li><a href="install.html">ダウンロードとインストール</a></li>
        <li><a href="requirements.html">動作条件</a></li>
        <li><a href="limitations.html">欠点</a></li>
        <li><a href="future-ideas.html">将来のアイデア</a></li>
        </ul>
        <h1 id="documentation">ドキュメント</h1>
        <ul>
        <li><a href="usage.html">使い方</a></li>
        <li><a href="examples.html">使用例</a></li>
        <li><a href="tutorial.html">チュートリアル</a></li>
        </ul>
        <h1 id="other">舞台裏</h1>
        <ul>
        <li><a href="changelog.html">更新履歴</a></li>
        <li><a href="implementation.html">実装</a></li>
        <li><a href="rationale.html">設計原理</a></li>
        </ul>
        <h1 id="author">作者</h1>
        <ul>
        <li><a href="contact.html">連絡先</a><br/>Twitter: <a href="https://twitter.com/harelba">@harelba</a><br/>Email: <a href="mailto:harelba@gmail.com">harelba@gmail.com</a></li>
        </ul>
        <h1 id="social">Social</h1>
        <ul>
        <li>Twitter: <a target="_blank" href="https://twitter.com/search?f=realtime&q=%23qtextasdata&src=typd">#qtextasdata</a></li>
        </ul>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
<h2>
<a name="synopsis" class="anchor" href="#synopsis"><span class="octicon octicon-link"></span></a>概要</h2>

<pre><code>`q &lt;flags&gt; &lt;query&gt;`

最もシンプルなコマンドは `q "SELECT * FROM myfile"` で、ファイル全体を表示します。
</code></pre>

<h2>
<a name="description" class="anchor" href="#description"><span class="octicon octicon-link"></span></a>説明</h2>

<p>q は SQL ライクな命令を表形式のテキストデータに対して実行することができます。SQL の強力な表現を Linux のコマンドラインで実行できるようにし、より簡単にテキストデータを扱えるようにするために作られました。</p>

<p>クエリはテーブル名の代わりにファイル名を含めます。(もしくは、標準入力の - でも可能) クエリは1つのパラメータとして渡してください。(すなわち、クオートで囲む)</p>

<p><code>-H</code> オプションを渡すと、ヘッダー行をカラム名として認識します。この場合、カラム名は自動的に検出され、クエリ中で使用することができます。もし、このオプションを使用しない場合は、カラムは左から cX (Xは1から始まる) として名付けられます。(例 q "SELECT c3,c8 from ...")</p>

<p><code>-d</code> オプションを使うと入力データのデリミタを指定できます。</p>

<p>カラムの型は自動検出されるので、キャストは不要です。</p>

<p>カラム名にスペースを含む必要がある時は、SQLite 標準の通り、クエリ中でバックティック(``)で囲んでください。</p>

<p>クエリ/入力データ/出力データのエンコードは完全サポートしています。(q はこの部分に関して、追加設定なしのユーザビリティを試みています) それぞれ、必要に応じて、<code>-e</code>,<code>-E</code> and <code>-Q</code> オプションを使用してください。</p>

<p>それぞれのテーブルにエイリアスを設定し、ファイルをまたいだ JOIN を含めて、SQLite3 の SQL 構造を全てサポートしています。</p>

<p>さらに詳細を知りたい場合は、<a href="https://github.com/harelba/q">https://github.com/harelba/q</a> を参照してください。</p>

<h2>
<a name="query" class="anchor" href="#query"><span class="octicon octicon-link"></span></a>クエリ</h2>

<p>q は "SQL ライクなクエリ"、たった1つをパラメータとして取得します</p>

<p>標準的な SQL 表現、条件文(WHERE、HAVING 両方とも)、GROUP BY、ORDER BY 等が使えます。</p>

<p>JOIN は WHERE 節のサブクエリとしてはサポートしていますが、FROM 節で使用するのは現時点で、未対応です。JOIN するときに、テーブルにエイリアスを設定して使ってください。</p>

<p>SQL 文法は、SQLite の文法と同じです。詳細は <a href="http://www.sqlite.org/lang.html">http://www.sqlite.org/lang.html</a> を参照するか、インターネットで例を検索してみてください。</p>

<p><strong>重要:</strong> 型検出が実装されているので、キャスト等の操作は一切不要です。</p>

<p><strong>重要2:</strong> 出力ヘッダーオプションである、<code>-O</code> を使用して、出力ヘッダのカラム名を制御したい場合、カラム名をエイリアスとして明示的に指定してください。たとえば、<code>q -O -H "select count(*) as cnt,sum(*) as mysum from -"</code> とすると、<code>cnt</code> と <code>mysum</code> が出力ヘッダーとして名前がつきます。</p>

<h2>
<a name="runtime-options" class="anchor" href="#runtime-options"><span class="octicon octicon-link"></span></a>RUNTIME OPTIONS</h2>

<p>q can also get some runtime flags. The following parameters can be used, all optional:</p>

<pre><code>Options:
  -h, --help            show this help message and exit
  -v, --version         Print version

  Input Data Options:
    -H, --skip-header   Skip header row. This has been changed from earlier
                        version - Only one header row is supported, and the
                        header row is used for column naming
    -d DELIMITER, --delimiter=DELIMITER
                        Field delimiter. If none specified, then space is used
                        as the delimiter.
    -t, --tab-delimited
                        Same as -d &lt;tab&gt;. Just a shorthand for handling
                        standard tab delimited file You can use $'\t' if you
                        want (this is how Linux expects to provide tabs in the
                        command line)
    -e ENCODING, --encoding=ENCODING
                        Input file encoding. Defaults to UTF-8. set to none
                        for not setting any encoding - faster, but at your own
                        risk...
    -z, --gzipped       Data is gzipped. Useful for reading from stdin. For
                        files, .gz means automatic gunzipping
    -A, --analyze-only  Analyze sample input and provide information about
                        data types
    -m MODE, --mode=MODE
                        Data parsing mode. fluffy, relaxed and strict. In
                        strict mode, the -c column-count parameter must 
                        be supplied as well
    -c COLUMN_COUNT, --column-count=COLUMN_COUNT
                        Specific column count when using relaxed or strict
                        mode
    -k, --keep-leading-whitespace
                        Keep leading whitespace in values. Default behavior
                        strips leading whitespace off values, in order to
                        provide out-of-the-box usability for simple use cases.
                        If you need to preserve whitespace, use this flag.

  Output Options:
    -D OUTPUT_DELIMITER, --output-delimiter=OUTPUT_DELIMITER
                        Field delimiter for output. If none specified, then
                        the -d delimiter is used if present, or space if no
                        delimiter is specified
    -T, --tab-delimited-output
                        Same as -D &lt;tab&gt;. Just a shorthand for outputing tab
                        delimited output. You can use -D $'\t' if you want.
    -O, --output-header
                        Output header line. Output column-names are determined
                        from the query itself. Use column aliases in order to
                        set your column names in the query. For example,
                        'select name FirstName,value1/value2 MyCalculation
                        from ...'. This can be used even if there was no
                        header in the input.
    -b, --beautify      Beautify output according to actual values. Might be
                        slow...
    -f FORMATTING, --formatting=FORMATTING
                        Output-level formatting, in the format X=fmt,Y=fmt
                        etc, where X,Y are output column numbers (e.g. 1 for
                        first SELECT column etc.
    -E OUTPUT_ENCODING, --output-encoding=OUTPUT_ENCODING
                        Output encoding. Defaults to 'none', leading to
                        selecting the system/terminal encoding

  Query Related Options:
    -q QUERY_FILENAME, --query-filename=QUERY_FILENAME
                        Read query from the provided filename instead of the
                        command line, possibly using the provided query
                        encoding (using -Q).
    -Q QUERY_ENCODING, --query-encoding=QUERY_ENCODING
                        query text encoding. Experimental. Please send your
                        feedback on this

</code></pre>

<h3>
<a name="table-names" class="anchor" href="#table-names"><span class="octicon octicon-link"></span></a>テーブル名</h3>

<p>テーブル名は読み込みたいファイル名となります。パスも許可されています。もし標準入力からデータを読みたい場合は "-" を使ってください。(例:<code>q "SELECT * FROM -"</code>)</p>

<p>複数ファイルは以下の方法で連結することができます。</p>

<ul>
<li>ファイル名を + で繋ぐ: <code>SELECT * FROM datafile1+datafile2+datefile3</code></li>
<li>glob マッチを使用する: <code>SELECT * FROM mydata*.dat</code></code>
</li>
</ul><p>.gz 拡張子を持つファイルは、中間ファイルを出力せずとも演算できます。<code>-z</code> オプションを使用してください。</p>

<h3>
<a name="parsing-modes" class="anchor" href="#parsing-modes"><span class="octicon octicon-link"></span></a>パースモード</h3>

<p>q supports multiple parsing modes:</p>

<ul>
<li>
<code>relaxed</code> - This is the default mode. It tries to lean towards simplicity of use. When a row doesn't contains enough columns, they'll be filled with nulls, and when there are too many, the extra values will be merged to the last column. Defining the number of expected columns in this mode is done using the <code>-c</code> parameter. If it is not provided, then the number of columns is detected automatically (In most use cases, there is no need to specify <code>-c</code>)</li>
<li>
<code>strict</code> - Strict mode is for hardcore csv/tsv parsing. Whenever a row doesn't contain the proper number of columns, processing will stop. <code>-c</code> must be provided when using this mode</li>
<li>
<code>fluffy</code> - This mode should not be used, and is just some kind of "backward compatible" parsing mode which was used by q previously. It's left as a separate parsing mode on purpose, in order to accomodate existing users. If you are such a user, please open a bug for your use case, and I'll see how I can incorporate it into the other modes. It is reasonable to say that this mode will be removed in the future.</li>
</ul><h3>
<a name="output-formatting-option" class="anchor" href="#output-formatting-option"><span class="octicon octicon-link"></span></a>Output formatting option</h3>

<p>The format of F is as a list of X=f separated by commas, where X is a column number and f is a python format:</p>

<ul>
<li>X - column number - This is the SELECTed column (or expression) number, not the one from the original table. E.g, 1 is the first SELECTed column, 3 is the third SELECTed column.</li>
<li>f - A python formatting string - See <a href="http://docs.python.org/release/2.4.4/lib/typesseq-strings.html">http://docs.python.org/release/2.4.4/lib/typesseq-strings.html</a> for details if needed.
** Example: <code>-f 3=%-10s,5=%4.3f,1=%x</code>
</li>
</ul><h2>
<a name="examples" class="anchor" href="#examples"><span class="octicon octicon-link"></span></a>EXAMPLES</h2>

<p>Example 1: <code>ls -ltrd * | q "select c1,count(1) from - group by c1"</code></p>

<pre><code>This example would print a count of each unique permission string in the current folder.
</code></pre>

<p>Example 2: <code>seq 1 1000 | q "select avg(c1),sum(c1) from -"</code></p>

<pre><code>This example would provide the average and the sum of the numbers in the range 1 to 1000
</code></pre>

<p>Example 3: <code>sudo find /tmp -ls | q "select c5,c6,sum(c7)/1024.0/1024 as total from - group by c5,c6 order by total desc"</code></p>

<pre><code>This example will output the total size in MB per user+group in the /tmp subtree
</code></pre>

<p>Example 4: <code>ps -ef | q -H "select UID,count(*) cnt from - group by UID order by cnt desc limit 3"</code></p>

<pre><code>This example will show process counts per UID, calculated from ps data. Note that the column names provided by ps are being used as column name in the query (The -H flag activates that option)
</code></pre>

<h2>
<a name="author" class="anchor" href="#author"><span class="octicon octicon-link"></span></a>AUTHOR</h2>

<p>Harel Ben-Attia (<a href="mailto:harelba@gmail.com">harelba@gmail.com</a>)</p>

<p><a href="https://twitter.com/harelba">@harelba</a> on Twitter</p>

<p>Any feedback/suggestions/complaints regarding this tool would be much appreciated. Contributions are most welcome as well, of course.</p>

<h2>
<a name="copyright" class="anchor" href="#copyright"><span class="octicon octicon-link"></span></a>COPYRIGHT</h2>

<p>Copyright (C) 2012--2014 Harel Ben Attia</p>

<p>This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3, or (at your option) any later version.</p>

<p>This program is distributed in the hope that it will be useful,but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details. You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA  02110-1301, USA </p>
      </section>
    </div>

  </body>
</html>
