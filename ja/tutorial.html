<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8' />
  <meta http-equiv="X-UA-Compatible" content="chrome=1" />
  <meta name="description" content="q : q - Text as Data" />

  <link rel="stylesheet" type="text/css" media="screen" href="../stylesheets/stylesheet.css">

  <title>チュートリアル</title>
  <script type="text/javascript" src="../javascripts/google-analytics.js"></script>
</head>

<body>

  <!-- HEADER -->
  <div id="header_wrap" class="outer">
    <header class="inner">
      <select id="language_switcher" onChange="window.location.href=this.value">
        <option value="../index.html">English</option>
        <option value="ja/index.html" selected>Japanese</option>
      </select>
      <img id="q-logo" src="../images/q-logo1.png"/>
      <a id="forkme_banner" href="https://github.com/harelba/q">View on GitHub</a>

      <h1 id="project_title">q</h1>
      <h2 id="project_tagline">q - Text as Data</h2>


      <iframe src="http://ghbtns.com/github-btn.html?user=harelba&repo=q&type=watch&count=true&size=large"  allowtransparency="true" frameborder="0" scrolling="0" width="170" height="30"></iframe>

      <section id="downloads">
        <a class="zip_download_link" download href="https://github.com/harelba/q/archive/1.6.3.zip">Download the last stable version zip file </a>
        <a class="tar_download_link" download href="https://github.com/harelba/q/archive/1.6.3.tar.gz">Download the last stable version tar.gz file</a>
        <a class="rpm_download_link" download href="https://github.com/harelba/packages-for-q/raw/master/rpms/q-text-as-data-1.6.3-1.noarch.rpm">Download the latest stable version RPM</a>
        <a class="deb_download_link" download href="https://github.com/harelba/packages-for-q/raw/master/deb/q-text-as-data_1.6.3-2_all.deb">Download the latest stable version Debian package</a>
        <a class="executable_download_link" title="Single file executable, for systems with python installed" href="https://cdn.rawgit.com/harelba/q/1.6.3/bin/q">Download the single-file executable</a>
        <a class="windows_download_link" title="Beta installation for Windows systems. Adds q.exe to the path. Please send me any comments" href="https://github.com/harelba/packages-for-q/raw/master/windows/setup-q-1.6.3.exe">Download the single-file executable</a>
      </section>
    </header>
  </div>

  <div id="sidenav">
    <h1 id="general">一般</h1>
    <ul>
      <li><a href="index.html">ホーム</a></li>
      <li><a href="install.html">ダウンロードとインストール</a></li>
      <li><a href="requirements.html">動作条件</a></li>
      <li><a href="limitations.html">制約</a></li>
      <li><a href="future-ideas.html">将来のアイデア</a></li>
    </ul>
    <h1 id="documentation">ドキュメント</h1>
    <ul>
      <li><a href="usage.html">使い方</a></li>
      <li><a href="examples.html">使用例</a></li>
      <li><a href="tutorial.html">チュートリアル</a></li>
    </ul>
    <h1 id="other">舞台裏</h1>
    <ul>
      <li><a href="changelog.html">更新履歴</a></li>
      <li><a href="implementation.html">実装</a></li>
      <li><a href="rationale.html">設計原理</a></li>
    </ul>
    <h1 id="author">作者</h1>
    <ul>
      <li><a href="contact.html">連絡先</a><br/>Twitter: <a href="https://twitter.com/harelba">@harelba</a><br/>Email: <a href="mailto:harelba@gmail.com">harelba@gmail.com</a></li>
    </ul>
    <h1 id="social">Social</h1>
    <ul>
      <li>Twitter: <a target="_blank" href="https://twitter.com/search?f=realtime&q=%23qtextasdata&src=typd">#qtextasdata</a></li>
    </ul>
  </div>
  <!-- MAIN CONTENT -->
  <div id="main_content_wrap" class="outer">
    <section id="main_content" class="inner">
      <h2>
        <a name="tutorial" class="anchor" href="#tutorial"><span class="octicon octicon-link"></span></a>チュートリアル</h2>

        <p>このページは初心者向けのチュートリアルです。もし概念に精通し、ただいくつかの本格的な例を見たいならば、<a href="examples.html">使用例のページ</a> を見てください。</p>

        <p>チュートリアルステップ:</p>

        <h2>シンプルな例</h2>
        <p>シンプルな例から動作をみていきましょう。 <code>exampledatafile</code> という <code>ls -l</code> コマンドの出力をファイルにしたものがあります。どこかのディレクトリのファイル一覧です。 この例では、このファイル一覧に対していくつかの計算をしていきます。</p>

        <ul>
          <li>
            <p>以下のコマンドは <em>exampledatafile</em> のファイルの行数を表示します。実際には、そのディレクトリのファイル数となります。この出力は <code>wc -l</code> コマンドを行ったときと同じ意味となります。  </p>

            <pre class="code_example_wrapper"><code class="code_example">  q "SELECT COUNT(1) FROM exampledatafile"

              cat exampledatafile | q "SELECT COUNT(1) FROM -"
            </code></pre>
          </li>
          <li>
            <p>さぁ、このディレクトリ内で、日付ごとのファイル数を知りたいとしましょう。日付の入っているカラムは 6 ですね。</p>

            <pre class="code_example_wrapper"><code class="code_example">  q "SELECT c6,COUNT(1) FROM exampledatafile GROUP BY c6"
            </code></pre>
          </li>
          <li>
            <p>日付ごとのファイルが表示されましたか。しかし、このままでは、1つのファイルしかカウントされなかった日付など、多くのいらない情報があります。 では、3ファイル以上のみを残してみましょう:  </p>

            <pre class="code_example_wrapper"><code class="code_example">  q "SELECT c6,COUNT(1) AS cnt FROM exampledatafile GROUP BY c6 HAVING cnt &gt;= 3"
            </code></pre>
          </li>
          <li>
            <p>さぁ、もっと面白い情報をみてみましょう。 以下のコマンドは日付ごとのファイルの <strong>合計サイズ</strong> を表示します。ファイルサイズのカラムは c5 ですね。</p>

            <pre class="code_example_wrapper"><code class="code_example">  q "SELECT c6,SUM(c5) AS size FROM exampledatafile GROUP BY c6"
            </code></pre>
          </li>
          <li>
            <p>結果が出ましたか。しかし、結果の総和はバイト単位になってしまっています。キロバイト単位で表示するようにしてみましょう。:  </p>

            <pre class="code_example_wrapper"><code class="code_example">  q "SELECT c6,SUM(c5)/1024.0 AS size FROM exampledatafile GROUP BY c6"
            </code></pre>
          </li>
          <li>
            <p>最後のコマンドは結果のリストを表示します。しかし結果は、順序付けもなければ、リストも長過ぎます。なので、上位 5 だけを表示するようにします。:  </p>

            <pre class="code_example_wrapper"><code class="code_example">  q "SELECT c6,SUM(c5)/1024.0 AS size FROM exampledatafile GROUP BY c6 ORDER BY size DESC LIMIT 5"
            </code></pre>
          </li>
          <li>
            <p>出力結果はいかがでしたか？以下のコマンドのほうがより良いフォーマットで出力します:  </p>

            <pre class="code_example_wrapper"><code class="code_example">  q -f "2=%4.2f" "SELECT c6,SUM(c5)/1024.0 AS size FROM exampledatafile GROUP BY c6 ORDER BY size DESC LIMIT 5"
            </code></pre>
          </li>
        </ul>
      </li>
    </ul>

    <br/>

    <h2>より複雑な例、時間操作</h2>
    <p>最初のカラムにタイムスタンプが入っているファイルがあるとします。1分ごとのファイル数を取得することが可能なところをお見せしましょう。:  </p>

    <pre class="code_example_wrapper"><code class="code_example">q "SELECT DATETIME(ROUND(c1/60000)*60000/1000,'unixepoch','-05:00') as min, COUNT(1) FROM datafile*.gz GROUP BY min"
    </code></pre>


    <p>いくつかの注記:</p>

    <ul>
      <li>タイムスタンプの値は最初のカラムです。なので、 c1 になっています。</li>
      <li>タイムスタンプはUNIX時間と仮定していますが、単位がミリ秒です。DATETIME は 秒を受け付けるので、 1000 で割る必要があります。</li>
      <li>分での四捨五入なので、 60000 ミリ秒で除算したあと、同じ数を掛けます。たとえば、時間で四捨五入をするときは、 60000 の代わりに 360000 を使えばよいです。</li>
      <li>ローカル時間のフォーマットで出力するために DATETIME の機能を使っています。このケースではニューヨーク時間に変換しています。(なので、マイナス5時間しています。)</li>
      <li>"datafile*.gz" にマッチングするすべてのファイルをファイル名として渡しています。複数ファイルも読み込めるし、 gz 拡張を持っているので、中間ファイル無しで出力できます。</li>
      <li>
        <strong>注:</strong> SQL を普段使用していないユーザへ, 日付操作に最初は戸惑うかもしれませんが、これは SQL では標準の処理であり使用するのは簡単です。</li>
      </ul>
    </li>
  </ul>

</body>
</html>
